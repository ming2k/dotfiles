# =======================================================================
# TMux Keybindings Configuration Module
# =======================================================================

# -----------------------------------------------------------------------------
# Prefix Key Configuration
# -----------------------------------------------------------------------------
# Default prefix is C-b, uncomment to change to C-Space
# unbind-key -T root C-b
# set -g prefix C-Space
# bind C-Space send-prefix

# -----------------------------------------------------------------------------
# Pane Splitting
# -----------------------------------------------------------------------------
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# -----------------------------------------------------------------------------
# Pane Management
# -----------------------------------------------------------------------------
bind X kill-pane -a

# -----------------------------------------------------------------------------
# Window Creation and Destruction
# -----------------------------------------------------------------------------
unbind c
bind c new-window -c "#{pane_current_path}"
bind C-t new-window -c "#{pane_current_path}"
bind C-w kill-window
bind & confirm-before -p "kill-window #W? (y/n)" kill-window

# -----------------------------------------------------------------------------
# Window Navigation
# -----------------------------------------------------------------------------
bind Tab last-window

# -----------------------------------------------------------------------------
# Window Movement
# -----------------------------------------------------------------------------
bind P swap-window -t -1\; select-window -t -1
bind N swap-window -t +1\; select-window -t +1

# -----------------------------------------------------------------------------
# Layout Management
# -----------------------------------------------------------------------------
unbind Space
bind Space next-layout
bind C-Space select-layout -o

bind M-1 select-layout even-horizontal
bind M-2 select-layout even-vertical
bind M-3 select-layout main-horizontal
bind M-4 select-layout main-vertical
bind M-5 select-layout tiled

bind = select-layout tiled
bind + select-layout main-horizontal

# -----------------------------------------------------------------------------
# Pane Synchronization
# -----------------------------------------------------------------------------
bind S setw synchronize-panes

# -----------------------------------------------------------------------------
# Copy Mode Entry
# -----------------------------------------------------------------------------
bind v copy-mode
bind C-v copy-mode
bind PPage copy-mode -u

# -----------------------------------------------------------------------------
# Copy Mode Navigation (Vi-style)
# -----------------------------------------------------------------------------
# Unbind default exit copy mode key
unbind -T copy-mode-vi q
# Use ESC to exit copy-mode-vi
bind-key -T copy-mode-vi Escape send-keys -X cancel

# Enable visual selection mode with prefix + v 
bind v copy-mode \; send-keys -X begin-selection
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi y send-keys -X copy-selection-no-clear \; display-message "Text copied!"
bind -T copy-mode-vi C-S-c send-keys -X copy-selection-and-cancel \; display-message "Text copied!"
bind -T copy-mode-vi Y send-keys -X copy-line \; display-message "Line copied!"

# -----------------------------------------------------------------------------
# Copy Mode Searching
# -----------------------------------------------------------------------------
bind -T copy-mode-vi / send-keys -X search-forward
bind -T copy-mode-vi ? send-keys -X search-backward
bind -T copy-mode-vi n send-keys -X search-again
bind -T copy-mode-vi N send-keys -X search-reverse

# -----------------------------------------------------------------------------
# Mouse Integration
# -----------------------------------------------------------------------------
bind -n MouseDrag1Border resize-pane -M
bind -T copy-mode-vi MouseDrag1Pane select-pane \; send-keys -X begin-selection
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X

bind -n DoubleClick1Pane select-pane \; copy-mode \; send-keys -X select-word
bind -T copy-mode-vi DoubleClick1Pane send-keys -X select-word
bind -n TripleClick1Pane select-pane \; copy-mode \; send-keys -X select-line
bind -T copy-mode-vi TripleClick1Pane send-keys -X select-line

bind -T copy-mode-vi MouseDown1Pane select-pane \; send-keys -X clear-selection

# -----------------------------------------------------------------------------
# Session Management
# -----------------------------------------------------------------------------
bind s choose-tree -Zs
bind S new-session

# -----------------------------------------------------------------------------
# Configuration and Utility
# -----------------------------------------------------------------------------
bind r source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded!"
bind t set-option status
bind C-l send-keys C-l \; clear-history

